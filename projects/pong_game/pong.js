function drawBall(){context.beginPath(),context.arc(ball.x,ball.y,ball.radius,0,2*Math.PI,!1),context.fillStyle="purple",context.fill(),context.closePath()}function updateBall(){if("playing"!==gameState)return;ball.x+=ball.dx,ball.y+=ball.dy,(ball.y+ball.radius>canvas.height||ball.y-ball.radius<0)&&(ball.dy*=-1,ball.y=ball.y-ball.radius<0?ball.radius:canvas.height-ball.radius);let t=null;if(ball.dx>0&&collisionDetect(rightPaddle,ball)?t=rightPaddle:ball.dx<0&&collisionDetect(leftPaddle,ball)&&(t=leftPaddle),t){ball.dx*=-1;let e=t.y+t.height/2,a=(ball.y-e)/(t.height/2)*(5*Math.PI/12),l=t===leftPaddle?1:-1;ball.dx=l*ball.speed*Math.cos(a),ball.dy=ball.speed*Math.sin(a),hitSound.play(),ball.x+=ball.dx>0?1:-1}else ball.x+ball.radius>canvas.width?(leftScore++,scoreSound.play(),addStars(ball.x-ball.radius,ball.y,100),lastScoredSide="left",checkWinCondition(),"playing"===gameState&&resetBall()):ball.x-ball.radius<0&&(rightScore++,scoreSound.play(),addStars(ball.x+ball.radius,ball.y,100),lastScoredSide="right",checkWinCondition(),"playing"===gameState&&resetBall())}function checkWinCondition(){leftScore>=winningScore?(gameState="gameOver",winner="Left Player"):rightScore>=winningScore&&(gameState="gameOver",winner="vsAI"===gameMode?"AI":"Right Player")}function resetBall(){ball.x=canvas.width/2,ball.y=canvas.height/2,resetBallDirection()}function resetBallDirection(){let t=(Math.random()-.5)*(Math.PI/2),e="right"===lastScoredSide?1:-1;ball.dx=e*ball.speed*Math.cos(t),ball.dy=ball.speed*Math.sin(t)}function drawPaddle(t,e,a,l,i){context.fillStyle=i,context.fillRect(t,e,a,l)}function collisionDetect(t,e){let a=Math.max(t.x,Math.min(e.x,t.x+t.width)),l=Math.max(t.y,Math.min(e.y,t.y+t.height)),i=e.x-a,d=e.y-l;return i*i+d*d<e.radius*e.radius}function drawScore(){context.font=`bold ${scoreFontSize}px Arial`,context.fillStyle="white",context.textAlign="center",context.fillText(leftScore,.25*canvas.width,.15*canvas.height),context.fillText(rightScore,.75*canvas.width,.15*canvas.height),context.textAlign="start"}function displayInfo(){context.font=`${infoFontSize}px Arial`,context.fillStyle="rgba(255, 255, 255, 0.7)",context.textAlign="center";let t=1.5*infoFontSize,e=3*infoFontSize,a=4.5*infoFontSize,l=`Mode: ${"vsAI"===gameMode?"Player vs AI":"Player vs Player"} (Press 'M' to Switch)`;if(context.fillText(l,canvas.width/2,t),"vsAI"===gameMode){let t=`Difficulty: ${aiDifficulty} (Press 'D' to Change)`;context.fillText(t,canvas.width/2,e)}if("playing"===gameState){let t="Press 'P' to Pause",l="vsAI"===gameMode?a:e;context.fillText(t,canvas.width/2,l)}"paused"===gameState?(context.font=`bold ${.8*scoreFontSize}px Arial`,context.fillStyle="yellow",context.fillText("PAUSED",canvas.width/2,canvas.height/2),context.font=`${1.5*infoFontSize}px Arial`,context.fillText("Press 'P' to Resume",canvas.width/2,canvas.height/2+50)):"gameOver"===gameState&&(context.fillStyle="rgba(0, 0, 0, 0.6)",context.fillRect(0,0,canvas.width,canvas.height),context.font=`bold ${scoreFontSize}px Arial`,context.fillStyle="lime",context.fillText("GAME OVER",canvas.width/2,canvas.height/2-50),context.font=`bold ${.7*scoreFontSize}px Arial`,context.fillStyle="white",context.fillText(`${winner} Wins!`,canvas.width/2,canvas.height/2+20),context.font=`${1.5*infoFontSize}px Arial`,context.fillText("Press 'R' to Restart",canvas.width/2,canvas.height/2+80)),context.textAlign="start"}function addStars(t,e,a){if("playing"===gameState)for(let l=0;l<a;l++)stars.push(new Star(t,e))}function updateStars(){if("gameOver"!==gameState)for(let t=stars.length-1;t>=0;t--)stars[t].update(),(stars[t].size<=.2||stars[t].opacity<=0)&&stars.splice(t,1);else stars=[]}function drawStars(){for(let t=0;t<stars.length;t++)stars[t].draw()}function drawNet(){context.beginPath(),context.setLineDash([5,15]),context.moveTo(canvas.width/2,0),context.lineTo(canvas.width/2,canvas.height),context.strokeStyle="rgba(255, 255, 255, 0.5)",context.lineWidth=5,context.stroke(),context.setLineDash([]),context.lineWidth=1}function updateAIPaddle(){if("playing"!==gameState||"vsAI"!==gameMode)return;const t=difficultySettings[aiDifficulty],e=rightPaddle.dy*t.speedMultiplier,a=rightPaddle.y+rightPaddle.height/2,l=2*(Math.random()-.5)*t.errorMargin,i=ball.y+l,d=10;a<i-d?rightPaddle.y+=e:a>i+d&&(rightPaddle.y-=e),rightPaddle.y=Math.max(0,Math.min(rightPaddle.y,canvas.height-rightPaddle.height))}function resetGame(){leftScore=0,rightScore=0,winner=null,stars=[],leftPaddle.y=canvas.height/2-leftPaddle.height/2,rightPaddle.y=canvas.height/2-rightPaddle.height/2,lastScoredSide="right",resetBall(),gameState="playing"}function animate(){context.fillStyle="#000",context.fillRect(0,0,canvas.width,canvas.height),drawNet(),drawScore(),displayInfo(),"gameOver"!==gameState?(drawPaddle(leftPaddle.x,leftPaddle.y,leftPaddle.width,leftPaddle.height,"red"),drawPaddle(rightPaddle.x,rightPaddle.y,rightPaddle.width,rightPaddle.height,"vsAI"===gameMode?"cyan":"blue"),drawBall(),drawStars(),"playing"===gameState&&(updateBall(),updateStars(),keyState.w&&leftPaddle.y>0?leftPaddle.y-=leftPaddle.dy:keyState.s&&leftPaddle.y<canvas.height-leftPaddle.height&&(leftPaddle.y+=leftPaddle.dy),leftPaddle.y=Math.max(0,Math.min(leftPaddle.y,canvas.height-leftPaddle.height)),"twoPlayer"===gameMode?(keyState.arrowup&&rightPaddle.y>0?rightPaddle.y-=rightPaddle.dy:keyState.arrowdown&&rightPaddle.y<canvas.height-rightPaddle.height&&(rightPaddle.y+=rightPaddle.dy),rightPaddle.y=Math.max(0,Math.min(rightPaddle.y,canvas.height-rightPaddle.height))):updateAIPaddle())):(drawPaddle(leftPaddle.x,leftPaddle.y,leftPaddle.width,leftPaddle.height,"red"),drawPaddle(rightPaddle.x,rightPaddle.y,rightPaddle.width,rightPaddle.height,"vsAI"===gameMode?"cyan":"blue"),drawBall()),requestAnimationFrame(animate)}const canvas=document.getElementById("pongCanvas"),context=canvas.getContext("2d");let initialWidth=document.documentElement.clientWidth,initialHeight=document.documentElement.clientHeight;canvas.width=initialWidth,canvas.height=initialHeight;let initialPaddleWidth=20,initialPaddleHeight=130,paddleWidth=20,paddleHeight=130,scoreFontSize=60,infoFontSize=20,leftPaddle={x:5,y:canvas.height/2-paddleHeight/2,width:paddleWidth,height:paddleHeight,dy:3.5},rightPaddle={x:canvas.width-paddleWidth-5,y:canvas.height/2-paddleHeight/2,width:paddleWidth,height:paddleHeight,dy:3.5},ballRadius=15,ballSpeed=3,ball={x:canvas.width/2,y:canvas.height/2,radius:ballRadius,speed:ballSpeed,dx:ballSpeed,dy:ballSpeed},lastScoredSide="right",gameState="playing",gameMode="twoPlayer";const winningScore=10;let winner=null,aiDifficulty="Medium";const difficultyLevels=["Easy","Medium","Hard","Impossible"],difficultySettings={Easy:{speedMultiplier:.3,errorMargin:50},Medium:{speedMultiplier:.5,errorMargin:25},Hard:{speedMultiplier:.8,errorMargin:10},Impossible:{speedMultiplier:1,errorMargin:0}};window.addEventListener("resize",()=>{let t=document.documentElement.clientWidth,e=document.documentElement.clientHeight,a=t/initialWidth,l=e/initialHeight;canvas.height,canvas.width;initialWidth=t,initialHeight=e,canvas.width=t,canvas.height=e,leftPaddle.x=5,leftPaddle.y=leftPaddle.y/(initialHeight/l),rightPaddle.x=canvas.width-paddleWidth-5,rightPaddle.y=rightPaddle.y/(initialHeight/l),ball.x=ball.x/(initialWidth/a),ball.y=ball.y/(initialHeight/l);const i=Math.min(a,l);ball.radius=Math.min(Math.max(ballRadius*i,8),25),ball.speed=Math.min(Math.max(ballSpeed*i,2),6);const d=Math.sqrt(ball.dx*ball.dx+ball.dy*ball.dy);d>0?(ball.dx=ball.dx/d*ball.speed,ball.dy=ball.dy/d*ball.speed):resetBallDirection(),paddleWidth=Math.min(Math.max(initialPaddleWidth*a,10),30),paddleHeight=Math.min(Math.max(initialPaddleHeight*l,80),200);const n=Math.sqrt(l);leftPaddle.width=paddleWidth,leftPaddle.height=paddleHeight,leftPaddle.dy=Math.min(Math.max(leftPaddle.dy*n,2),6),rightPaddle.width=paddleWidth,rightPaddle.height=paddleHeight,rightPaddle.dy=Math.min(Math.max(rightPaddle.dy*n,2.5),7),leftPaddle.y=Math.max(0,Math.min(leftPaddle.y,canvas.height-leftPaddle.height)),rightPaddle.y=Math.max(0,Math.min(rightPaddle.y,canvas.height-rightPaddle.height)),scoreFontSize=Math.min(Math.max(60*i,30),80),infoFontSize=Math.min(Math.max(20*i,15),30),context.font=`${scoreFontSize}px Arial`,context.textAlign="start"});let keyState={};window.addEventListener("keydown",function(t){switch(keyState[t.key.toLowerCase()]=!0,"gameOver"===gameState||"ArrowUp"!==t.key&&"ArrowDown"!==t.key||t.preventDefault(),t.key.toLowerCase()){case"p":"playing"===gameState?gameState="paused":"paused"===gameState&&(gameState="playing");break;case"m":"gameOver"!==gameState&&(gameMode="twoPlayer"===gameMode?"vsAI":"twoPlayer",resetGame());break;case"r":"gameOver"===gameState&&resetGame();break;case"d":if("vsAI"===gameMode&&"gameOver"!==gameState){let t=difficultyLevels.indexOf(aiDifficulty);t=(t+1)%difficultyLevels.length,aiDifficulty=difficultyLevels[t]}}}),window.addEventListener("keyup",function(t){keyState[t.key.toLowerCase()]=!1});let leftScore=0,rightScore=0,hitSound=new Audio("hit.wav"),scoreSound=new Audio("score.wav");class Star{constructor(t,e){this.x=t,this.y=e,this.size=5*Math.random()+5,this.speedX=10*(Math.random()-.5),this.speedY=10*(Math.random()-.5),this.opacity=1,this.opacitySpeed=.02}draw(){context.fillStyle=`rgba(255, 255, 255, ${this.opacity})`,context.beginPath();const t=5,e=this.size,a=this.size/2;let l=Math.PI/2*3,i=this.x,d=this.y,n=Math.PI/t;context.moveTo(i,d-e);for(let h=0;h<t;h++)i=this.x+Math.cos(l)*e,d=this.y+Math.sin(l)*e,context.lineTo(i,d),l+=n,i=this.x+Math.cos(l)*a,d=this.y+Math.sin(l)*a,context.lineTo(i,d),l+=n;context.lineTo(this.x,this.y-e),context.closePath(),context.fill()}update(){this.x+=this.speedX,this.y+=this.speedY,this.size>.2&&(this.size-=.1),this.opacity>0&&(this.opacity-=this.opacitySpeed)}}let stars=[];resetGame(),animate();